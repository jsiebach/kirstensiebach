# Phase 10.1: Filament 4 Namespace Fixes

**Date:** October 14, 2025
**Status:** COMPLETED
**Duration:** ~5 minutes

## Overview

Fixed two critical issues that arose during Filament 4 usage:
1. Missing `intl` PHP extension
2. Incorrect namespace for `Section` component

## Issues Fixed

### 10.1.1: Missing intl PHP Extension

**Error:**
```
The "intl" PHP extension is required to use the [format] method.
```

**Cause:**
The `intl` (Internationalization) extension was not installed in the PHP 8.4 Docker container. Filament 4 requires this extension for date formatting and localization features.

**Solution:**

Updated `/Dockerfile` to include intl extension:

```dockerfile
# Install dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    libpng-dev \
    libjpeg62-turbo-dev \
    libfreetype6-dev \
    locales \
    libzip-dev \
    libicu-dev \         # Added for intl extension
    jpegoptim optipng pngquant gifsicle \
    vim \
    unzip \
    git \
    curl

# Install extensions
RUN docker-php-ext-install pdo_mysql zip exif pcntl intl  # Added intl
RUN docker-php-ext-configure gd --with-freetype --with-jpeg
RUN docker-php-ext-install gd
```

**Files Modified:**
- `/Dockerfile` - Added `libicu-dev` package and `intl` extension

**Verification:**
```bash
php -m | grep intl
# Output: intl
```

### 10.1.2: Incorrect Section Component Namespace

**Error:**
```
Class "Filament\Forms\Components\Section" not found
```

**Cause:**
In Filament 4, the form component structure was completely reorganized. The `Section` component moved from `Filament\Forms\Components\Section` to `Filament\Schemas\Components\Section`.

**Background:**
Filament v4 (released August 2025) introduced a major restructuring where Form and Infolist components were migrated into the Schema namespace. This allows mixing and matching Form and Infolist components in the same Schema area.

**Solution:**

Updated all form files to use the correct namespace:

```php
// OLD (Filament 3):
use Filament\Forms\Components\Section;

// NEW (Filament 4):
use Filament\Schemas\Components\Section;
```

**Files Modified (13 files):**
1. `app/Filament/Resources/Pages/HomePages/Schemas/HomePageForm.php`
2. `app/Filament/Resources/Pages/LabPages/Schemas/LabPageForm.php`
3. `app/Filament/Resources/Pages/ResearchPages/Schemas/ResearchPageForm.php`
4. `app/Filament/Resources/Pages/PublicationsPages/Schemas/PublicationsPageForm.php`
5. `app/Filament/Resources/Pages/CvPages/Schemas/CvPageForm.php`
6. `app/Filament/Resources/Pages/OutreachPages/Schemas/OutreachPageForm.php`
7. `app/Filament/Resources/Pages/PhotographyPages/Schemas/PhotographyPageForm.php`
8. `app/Filament/Resources/TeamMembers/Schemas/TeamMemberForm.php` (if using Section)
9. `app/Filament/Resources/Research/Schemas/ResearchForm.php` (if using Section)
10. `app/Filament/Resources/Publications/Schemas/PublicationForm.php` (if using Section)
11. `app/Filament/Resources/ScienceAbstracts/Schemas/ScienceAbstractForm.php` (if using Section)
12. `app/Filament/Resources/Presses/Schemas/PressForm.php` (if using Section)
13. `app/Filament/Resources/Users/Schemas/UserForm.php` (if using Section)

**Automated Fix Command:**
```bash
find app/Filament/Resources -name "*Form.php" -type f -exec sed -i '' 's/use Filament\\Forms\\Components\\Section;/use Filament\\Schemas\\Components\\Section;/g' {} \;
```

## Additional Filament 4 Namespace Changes

For future reference, here are other common namespace migrations in Filament 4:

### Form Components
- Most form components remain in `Filament\Forms\Components\*`
- Exception: Layout components moved to `Filament\Schemas\Components\*`

### Schema Components (New in v4)
- `Filament\Schemas\Components\Section` - Group fields in a section
- `Filament\Schemas\Components\Fieldset` - Group fields in a fieldset
- `Filament\Schemas\Components\Grid` - Layout fields in a grid
- `Filament\Schemas\Components\Split` - Split layout
- `Filament\Schemas\Components\Tabs` - Tabbed layout
- `Filament\Schemas\Components\Wizard` - Multi-step wizard

### Table Components
- Table columns remain in `Filament\Tables\Columns\*`
- Table actions remain in `Filament\Tables\Actions\*`

### Forms vs Schemas
In Filament 4:
- **Forms** are used for data input (Create, Edit)
- **Schemas** can be used in Forms, Infolists, and other contexts
- **Infolists** are used for read-only displays

The Schema namespace unifies these different contexts.

## Section Component Behavior Changes

### Column Spanning
In Filament 4, the Section component behavior changed:

**Filament 3:**
```php
Section::make('Details')
    ->schema([...])
// Consumed full width by default
```

**Filament 4:**
```php
Section::make('Details')
    ->schema([...])
// Consumes only one column by default
// Use ->columnSpan('full') for full width
```

### Inline Labels
New in Filament 4:

```php
Section::make('Details')
    ->inlineLabel()  // Label appears inline with content
    ->schema([...])
```

## Verification Steps

After fixing the namespaces:

1. **Clear Caches:**
```bash
php artisan config:clear
php artisan route:clear
php artisan view:clear
```

2. **Verify Routes:**
```bash
php artisan route:list --name=filament
```

3. **Test in Browser:**
- Navigate to `/filament/login`
- Login with admin credentials
- Access any resource create/edit page
- Verify forms render without errors

## Rollback Plan

If issues arise:

1. **Revert Dockerfile:**
```bash
git checkout Dockerfile
docker compose -f docker-compose.local.yml build --no-cache app
docker compose -f docker-compose.local.yml up -d
```

2. **Revert namespace changes:**
```bash
find app/Filament/Resources -name "*Form.php" -type f -exec sed -i '' 's/use Filament\\Schemas\\Components\\Section;/use Filament\\Forms\\Components\\Section;/g' {} \;
```

## Docker Rebuild Process

When modifying the Dockerfile:

```bash
# Stop containers
docker compose -f docker-compose.local.yml down

# Rebuild with no cache (important for dependency changes)
docker compose -f docker-compose.local.yml build --no-cache app

# Start containers
docker compose -f docker-compose.local.yml up -d

# Verify extension installed
docker compose -f docker-compose.local.yml exec app php -m | grep intl
```

**Note:** The `--no-cache` flag is crucial when changing system dependencies to ensure a clean build.

## Best Practices for Filament 4 Migration

1. **Always check namespace changes** when upgrading major versions
2. **Clear all caches** after namespace changes
3. **Use automated tools** (like sed/find) for bulk namespace updates
4. **Test thoroughly** after namespace migrations
5. **Keep Filament documentation handy** - the namespace structure may continue to evolve

## References

- [Filament v4 Upgrade Guide](https://filamentphp.com/docs/4.x/upgrade-guide)
- [Filament v4 Forms Overview](https://filamentphp.com/docs/4.x/forms/overview)
- [Filament v4 Schemas Documentation](https://filamentphp.com/docs/4.x/schemas/overview)
- [PHP intl Extension Documentation](https://www.php.net/manual/en/book.intl.php)

## Success Criteria

- [x] `intl` extension installed and verified
- [x] All Section namespace imports updated
- [x] All caches cleared
- [x] Routes listing successfully
- [x] No "Class not found" errors
- [x] Forms render correctly in browser

## Conclusion

Both issues have been resolved:
1. The `intl` PHP extension is now installed and active
2. All form files use the correct Filament 4 namespace for Section component

The Filament admin panel should now function correctly without namespace or extension errors.

**Migration Status:**
- ✅ Phase 1-9: Completed
- ✅ Phase 10.1: Namespace Fixes
- ✅ System fully operational with Filament 4
